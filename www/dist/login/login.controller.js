angular.module("app.login",[]).controller("LoginCtrl",["$scope","$rootScope","$timeout","$location","$interval","$state","FirebaseConfig","$firebaseObject","$firebaseArray","$firebaseAuth","$translate",function(e,n,o,i,t,s,r,a,c,l,u){n.firstTimeUser=!1,e.login={},n.login_message=null,n.spinner=!1;e.returnToLogin=function(){s.go("login")},e.userLogin=function(o,i){n.spinner=!0,e.authObj.$authWithPassword({email:o,password:i}).then(function(e){n.login_message="signin you up..."},function(t){"INVALID_ARGUMENTS"==t.code?n.login_message="invalid credentials":"INVALID_USER"==t.code?n.login_message="This email is not registered":"INVALID_EMAIL"==t.code?n.login_message="The email provided is invalid":"INVALID_PASSWORD"==t.code?n.login_message="The password provided is incorrect":"EMAIL_TAKEN"==t.code?(n.login_message="The email provided is already taken",e.userLogin(o,i)):t&&(n.login_message="Please verify your informations"),n.spinner=!1})},e.userRegister=function(){s.go("register")},e.userLoginPage=function(){s.go("userLogin")},e.returnToLogin=function(){s.go("login")},e.googleLogin=function(){n.spinner=!0;var o=new Firebase(r.root_url);o.authWithOAuthPopup("google",function(i,t){i&&(console.log("Authentication Failed!",i),"TRANSPORT_UNAVAILABLE"===i.code?o.authWithOAuthRedirect("google",function(o,i){o?(console.log("Login Failed!",o),n.spinner=!1):(n.authData=i,e.onAuthUser())},{scope:"email"}):(n.spinner=!1,console.log(i)))},{scope:"email"})},e.twitterLogin=function(){n.spinner=!0;var o=new Firebase(r.root_url);o.authWithOAuthPopup("twitter",function(i,t){i?(console.log("Authentication Failed!",i),"TRANSPORT_UNAVAILABLE"===i.code?o.authWithOAuthRedirect("twitter",function(o,i){o?(console.log("Login Failed!",o),n.spinner=!1):(n.authData=i,e.onAuthUser())}):(n.spinner=!1,console.log(i))):(n.authData=t,e.onAuthUser())})},e.fbLogin=function(){n.spinner=!0;var e=new Firebase(r.root_url);e.authWithOAuthPopup("facebook",function(o,i){o&&(console.log("Authentication Failed!",o),"TRANSPORT_UNAVAILABLE"===o.code?e.authWithOAuthRedirect("facebook",function(e,o){e&&(console.log("Login Failed!",e),n.spinner=!1)}):(n.spinner=!1,console.log(o)))})},e.fbAppLogin=function(){n.spinner=!0;var o=function(o){n.friendsData=o,e.onAuthUser()},i=function(o){n.spinner=!1,e.$apply()},t=function(e){var i=new Firebase(r.root_url);i.authWithOAuthToken("facebook",e.authResponse.accessToken,function(i,t){i?(n.spinner=!1,console.log("Login Failed!",i)):(n.authData=t,n.fbData=e,facebookConnectPlugin.api("/me/friends?fields=id,name,picture",["user_friends"],o,function(e){alert(""+e)}))})};facebookConnectPlugin.login(["public_profile","email","user_friends"],t,i)},e.userLoginPasswordReset=function(e){n.spinner=!0,ref.resetPassword({email:e?e:"null@verynull.com"},function(o){o?(n.login_message="Please verify your email:"+o,n.spinner=!1,n.$apply()):(n.login_message="Password reset email sent successfully to "+e,n.spinner=!1,n.$apply())})}}]).controller("AccountCtrl",["$sce","$scope","$rootScope","$state","$firebaseObject","$cordovaStatusbar","FirebaseConfig","$translate",function(e,n,o,i,t,s,r,a){o.spinner=!1,n.$on("$ionicView.enter",function(e){var o=new Firebase(r.welcome_message),i=t(o);i.$bindTo(n,"privateData")}),n.unAuth=function(){var e=new Firebase(r.root_url);e.unauth(),n.gotoLogin()},n.gotoLogin=function(){o.privateData=null,i.go("login")},n.inviteFbFriend=function(){facebookConnectPlugin.showDialog({method:"send",name:"name",picture:"http://i.imgur.com/g3Qc1HN.png",link:"http://www.iAspireLab.com",caption:"caption of choice",description:"description of choice"},function(e){alert(JSON.stringify(e))},function(e){alert(JSON.stringify(e))})},n.postFbStatus=function(){facebookConnectPlugin.showDialog({method:"feed",name:"name",picture:"http://i.imgur.com/g3Qc1HN.png",link:"http://www.iAspireLab.com",caption:"iAspireLab",description:"description of choice"},function(e){alert(JSON.stringify(e))},function(e){alert(JSON.stringify(e))})},n.changePassword=function(){var e=new Firebase(r.root_url);e.changePassword({email:"bobtony@firebase.com",oldPassword:"correcthorsebatterystaple",newPassword:"neatsupersecurenewpassword"},function(e){null===e?console.log("Password changed successfully"):console.log("Error changing password:",e)})}}]);