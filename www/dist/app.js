angular.module("app",["ionic","app.help","app.home","pascalprecht.translate","ngResource","firebase","ngCordova"]).run(["$firebaseAuth","$ionicPlatform","$state","$rootScope","$timeout","$cordovaDevice","FirebaseConfig","$cordovaGlobalization","$translate","$cordovaStatusbar","$ionicPopup",function(e,o,n,a,i,t,r,l,u,c,s){a.spinner=!1,u.use("en"),a.goHome=function(){n.go("tabs.home")},a.goHelp=function(){n.go("tabs.help")},a.goAccount=function(){n.go("tabs.account")};var d=new Firebase(r.root_url);a.authObj=e(d),a.authObj.$onAuth(function(e){null===e||(console.log("Logged in as",e.uid),n.go("tabs.home"))}),a.unAuth=function(){var e=new Firebase(r.root_url);e.unauth(),n.go("login")},a.onAuthUser=function(){function e(e){switch(e.provider){case"password":return e.password.email.replace(/@.*/,"");case"twitter":return e.twitter.displayName;case"facebook":return e.facebook.displayName;case"google":return e.google.displayName}}function o(e){switch(e.provider){case"password":return e.password.email;case"twitter":return e.twitter.displayName;case"facebook":return e.facebook.email;case"google":return e.google.email}}var n=new Firebase(r.users_url),t=function(n){if(n){console.log(r.users_url+n.uid);var t=new Firebase(r.root_url+n.uid);i(function(){a.authData=n,"twitter"==n.provider?a.ownerPictureUrl=n.twitter.cachedUserProfile.profile_image_url:"facebook"==n.provider&&(a.ownerPictureUrl=n.facebook.cachedUserProfile.picture.data.url),t.once("value",function(i){i.val()?t.update({name:e(n),email:o(n)?o(n):null,picture:a.ownerPictureUrl,lastConnexionDate:Firebase.ServerValue.TIMESTAMP}):t.set({provider:n.provider,name:e(n),email:o(n)?o(n):null,picture:a.ownerPictureUrl,accountCreationDate:Firebase.ServerValue.TIMESTAMP})})})}};n.onAuth(t)},o.ready(function(){window.Connection&&(navigator.connection.type==Connection.NONE&&s.confirm({title:"No Internet Connection",content:"Sorry, no Internet connectivity detected. Please reconnect and try again."}).then(function(e){e||ionic.Platform.exitApp()}),a.online=navigator.onLine?"online":"offline",a.$apply(),window.addEventListener?(window.addEventListener("online",function(){a.online="online",a.$apply()},!0),window.addEventListener("offline",function(){a.online="offline",a.$apply()},!0)):(document.body.ononline=function(){a.online="online",a.$apply()},document.body.onoffline=function(){a.online="offline",a.$apply()})),window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&c.style(),window.navigator.language?(a.globalization={value:window.navigator.language},u.use(a.globalization.value)):window.navigator.userLanguage&&(a.globalization={value:window.navigator.userLanguage},u.use(a.globalization.value)),a.device=t.getDevice(),l.getPreferredLanguage().then(function(e){a.globalization=e,a.globalization.value=a.globalization.value.substring(0,2),u.use(a.globalization.value)},function(e){a.globalization=e})},!1)}]);